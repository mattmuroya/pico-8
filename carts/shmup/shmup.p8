pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- main loop

function _init()
	cls(0)
	mode="start"
	blink_t=1
end

function _update()
	blink_t+=1
	if mode=="game" then update_game()
	elseif mode=="start" then update_start()
	elseif mode=="over" then update_over()
	end
end

function _draw()
	if mode=="game" then draw_game()
	elseif mode=="start" then draw_start()
	elseif mode=="over" then draw_over()
	end
	-- debug
	-- print("> "..(enemies and #enemies or '0'),1,122,7)
end

function start_game()
	mode="game"
	-- init stars
	stars={}
	for i=1,80 do
		add(stars,{
			x=flr(rnd(128)),
			y=flr(rnd(128)),
			spd=rnd(1.5)+0.5
		})
	end
	-- init ship
	ship={
		spr=2,
		x=60,
		y=60,
		spd={
			x=0,
			y=0
		}
	}
	--init flame
	flame=5
	-- init lasers
	lasers={}
	muzzle=0
	-- init enemies
	enemies={}
	add(enemies,{
		spr=37,
		x=60,
		y=10
	})
	-- init player stats
	score=10000
	lives=2
end
-->8
-- utils

function blink()
	local frames = {5,5,5,5,5,5,5,5,5,6,6,7,7,6,6}
	if blink_t>#frames then blink_t=1 end
	return frames[blink_t]
end
-->8
-- update functions

function update_game()
	--reset speed and sprite
	ship.spd.x=0
	ship.spd.y=0
	ship.spr=2
	--animate starfield
	for star in all(stars) do
		star.y+=star.spd
		if star.y>=128 then star.y=0
		end
	end
	--set x speed
	if btn(0) and btn(1) then
		if btn_0_was_last then ship.spd.x+=2
		else ship.spd.x-=2
		end
	elseif btn(0) then 
		btn_0_was_last=true
		ship.spd.x-=2
		ship.spr=1
	elseif btn(1) then
		btn_0_was_last=false
		ship.spd.x+=2
		ship.spr=3
	end
	--set y speed
	if btn(2) and btn(3) then
		if btn_2_was_last then ship.spd.y+=2
		else ship.spd.y-=2
		end
	elseif btn(2) then 
		btn_2_was_last=true
		ship.spd.y-=2
	elseif btn(3) then
		btn_2_was_last=false
		ship.spd.y+=2
	end
	--calculate ship position
	ship.x+=ship.spd.x
	ship.y+=ship.spd.y
	--animate flame
	if flame>9 then flame=5
	else flame+=1
	end
	--fire laser
	if btnp(5) then
		add(lasers,{
			x=ship.x,
			y=ship.y-4,
			spr=21
		})
		muzzle=5
		sfx(0)
	end
	--animate lasers and muzzle
	for laser in all(lasers) do
		laser.y-=3
		if laser.y<-8 then del(lasers,laser)
		elseif laser.spr<24.5 then laser.spr+=.5
		else laser.spr=21
		end
	end
	if muzzle>0 then muzzle-=1
	end
	-- animate enemies
	for enemy in all(enemies) do
		enemy.y+=1
		if enemy.y>=128 then del(enemies,enemy)
		elseif enemy.spr<40.9 then enemy.spr+=.1
		else enemy.spr=37
		end
	end
	-- reset position if hit bound
	if ship.x>=120 then	ship.x=120
	elseif ship.x<=0 then	ship.x=0
	end
	if ship.y>=120 then	ship.y=120
	elseif ship.y<=0 then	ship.y=0
	end
end

function update_start()
	if btnp(5) or btnp(4) then start_game()
	end
end

function update_over()
	if btnp(5) or btnp(4) then mode="start"
	end
end
-->8
-- draw functions

function draw_game()
	cls(0)
	-- draw starfield
	for star in all(stars) do
		local color=6
		if star.spd<1 then color=1
		elseif star.spd<1.5 then color=13
		end
		if star.spd>1.9 then line(star.x,star.y,star.x,star.y+4,color)
		else pset(star.x,star.y,color)
		end
	end
	-- draw enemies
	for enemy in all(enemies) do
		spr(enemy.spr,enemy.x,enemy.y)
	end
	-- draw ship and flame
	spr(ship.spr,ship.x,ship.y)
	if flame <=9 then spr(flame,ship.x,ship.y+8)
	end
	--draw lasers and muzzle
	for laser in all(lasers) do
		spr(laser.spr,laser.x,laser.y)
	end
	if muzzle>0 then
		circfill(ship.x+3,ship.y-2,muzzle,muzzle>2 and 12 or 7)
		circfill(ship.x+4,ship.y-2,muzzle,muzzle>2 and 12 or 7)
	end
	-- draw player stats
	print("score:"..score,40,3,12)
	for i=1,4 do
		spr(lives>=i and 12 or 13, 2 + (i-1) * 9, 2)
	end
end

function draw_start()
	cls(1)
	print("my awesome shmup",32,40,12)
	print("press any key to start",20,80,blink())
end

function draw_over()
	cls(8)
	print("game over",46,40,2)
	print("press any key to continue",15,80,blink())
end
__gfx__
00000000000880000008800000088000000000000000000000000000000000000000000000000000000000000000000008800880088008800000000000000000
000000000099980000899800008999000000000000a77a0000077000000770000007700000a77a00000000000000000087788888800880080000000000000000
0070070000bb3800083bb3800083bb0000000000000aa000000aa00000077000000aa000000aa000000000000000000087888888800000080000000000000000
00077000009938000839938000839900000000000000000000099000000aa0000009900000000000000000000000000088888888800000080000000000000000
00077000099999808999999808999990000000000000000000000000000990000000000000000000000000000000000008888880080000800000000000000000
007007000a99a98089a99a98089a99a0000000000000000000000000000220000000000000000000000000000000000000888800008008000000000000000000
000000000a99a88088a99a88088a99a0000000000000000000000000000000000000000000000000000000000000000000088000000880000000000000000000
00000000008888000088880000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000011110000111100001111000011110000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000001cccc1001cccc1001cccc1001cccc1000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000001cc77cc11cc77cc11cc77cc11cc77cc100000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000001c7777c11c7777c11c7777c11c7777c100000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000001cc77cc11ccc77c11cc77cc11c77ccc100000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000001cccc10001cccc001cccc100cccc10000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000001cc10000c1cc10001cc10001cc1c0000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000001100000001100000110000011000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000bbbb0000bbbb0000bbbb0000bbbb0000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000b3223b00b3333b00b3223b00b3333b000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000b322823bb332233bb328223bb332233b00000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000b328823bb328823bb328823bb328823b00000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000bbbbbb00bbbbbb00bbbbbb00bbbbbb000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000f000000f0f0000f0f000000f0f0000f000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000f0000f000f00f000f0000f000f00f0000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000060000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000
00088008800088008800088008800088008800000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000
00877888880877888880800880080800880080000cc00cc00cc0ccc0ccc00000cc00ccc0ccc0ccc0ccc000000000000000000000000000000000000000000000
0087888888087888888080000008080000008000c000c000c0c1c0c0c6000c060c00c0c0c0c0c0c0c0c00000000000000000000000000000000000d000000000
0088888888088888888080000008080000008000ccc0c000c0c0cc00cc0000000c00c0c0c0c0c0c0c0c000000000000000000000000000000000000000000000
000888888000888888000800008000800008000000c0c000c0c0c0c0c0000c000c00c0c0c0c0c0c0c0c000000000000000000000000000000000000000000000
0000888800000888800000800800000800800000cc000cc0cc00c0c0ccc00000ccc0ccc0ccc0ccc0ccc00000000d000100000000000000000000000000000000
00000880000000880000000880000000880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000006000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000d000000
00000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000001000000006000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000060000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000006000000000000000
000000000000000000000000000000000000000000000000d0000000000000000000000000000000000000000000000000000000000000000000000000001000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000
0000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000d00000000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000
00000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000100000000000000
00000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000088000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000899800000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000083bb380000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000008399380000000000000000000000000000000000000000000000000000000600000
00000000000000000000000000000001000000000000000000000000000089999998000000000000000000000000000000001000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000089a99a98000000000000000000000000000000000000000000000000000000001000
00000000000000000000000000000000000000000000000000000000000088a99a88000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000888800000000000000000000000000000000000000000000000000000000000060
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000077000000000000000000000000000000000000000000000000000d00000000000
000000000000000000000000000000000000000000000000000000000000000aa000000001000000000000000000000000000000000000000000000000000000
00000000000000001000000000000000000000000000000000000000000000099000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000d0000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000060d000000000000000010000000000000000000000000
00006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000d00000000000000000010000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000
0000000000100000000000000000000000000006000000000000d000000000000000100000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000d00600000000000000000000000000000000000000000000000000000
00000000000d000000000000000000000000000000000000000000000000000000000000000000000d0000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000
00000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d00000
00000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
000100002f3502e350363502c35031350293502d350273502635024350243502335022350203501e3501c3501a350183501535013350113500e3500b350073500435003350003000030002000005000050000500
